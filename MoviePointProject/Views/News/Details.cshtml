@model MoviePoint.ViewModel.MovieWithUserViewModel

@{
    ViewData["Title"] = "Details";
	Layout = "_NavAndFooterLayout";
}

<section class="breadcrumb-area">
	<div class="container">
		<div class="row">
			<div class="col-lg-12">
				<div class="breadcrumb-area-content">
					<h1>Blog Details Page</h1>
				</div>
			</div>
		</div>
	</div>
</section><!-- breadcrumb area end -->
<!-- blog area start -->
<section class="blog-details">
	<div class="container">
		<div class="row">
			<div class="col-lg-9">
				<div class="news-details">
					<div class="single-news">
						<div style="height: 350px;">
							<img src="@Model.Movie.ImageUrl" alt="MoviePic" style="width:100% !important;height: 350px !important;object-fit:cover !important;" />
						</div>
						<div class="news-date">
							<h2>
								<span>
									@Model.Movie.StartDate.ToString("MMM").ToUpper()
								</span> @Model.Movie.StartDate.Day
							</h2>
							<h1>@Model.Movie.StartDate.Year</h1>
						</div>
					</div>
					<h2>@Model.Movie.Name</h2>
					<a href="#"><i class="icofont icofont-users"></i>@Model.Movie.Category.ToString()</a>
					<a href="#"><i class="icofont icofont-comment"></i>1k Comments</a>
					<p>@Model.Movie.Description</p>
					<div class="detail-author">
						<div class="row flexbox-center">
							@*<div class="col-lg-6 text-lg-left text-center">
								<div class="details-author">
									<h4>By Admin:</h4>
									<img src="/img/author.png" alt="" />
								</div>
							</div>*@
							<div class="col-lg-6 text-lg-left text-center">
								<div class="details-author">
									<h4>Share:</h4>
									<a href="#"><i class="icofont icofont-social-facebook"></i></a>
									<a href="#"><i class="icofont icofont-social-twitter"></i></a>
									<a href="#"><i class="icofont icofont-social-pinterest"></i></a>
									<a href="#"><i class="icofont icofont-social-linkedin"></i></a>
									<a href="#"><i class="icofont icofont-social-google-plus"></i></a>
								</div>
							</div>
						</div>
					</div>
					<div class="text-center">
						<img src="/img/blog-detail.png" alt="" />
					</div>
					<div class="details-reply">
						<h2>Leave a Reply</h2>
						<form action="#">
							<div class="row">
								@*<div class="col-lg-4">
									<div class="select-container">
										<input type="text" placeholder="Name" />
										<i class="icofont icofont-ui-user"></i>
									</div>
								</div>
								<div class="col-lg-4">
									<div class="select-container">
										<input type="text" placeholder="Email" />
										<i class="icofont icofont-envelope"></i>
									</div>
								</div>
								<div class="col-lg-4">
									<div class="select-container">
										<input type="text" placeholder="Phone" />
										<i class="icofont icofont-phone"></i>
									</div>
								</div>*@
								
								<div class="col-lg-12">
									<div class="textarea-container">
										<textarea id="textcomment" placeholder="Type Here Message"></textarea>
										<button><i class="icofont icofont-send-mail"></i></button>
									</div>
								</div>
							</div>
						</form>
					</div>
					<div class="details-comment">
						@*<button onclick="SendComment()"class="theme-btn theme-btn2">Post Comment</button>*@
						<button class="theme-btn theme-btn2" onclick="SendComment()">Post Comment</button>
@*						<p id="AllMsg">You may use these HTML tags and attributes: You may use these HTML tags and attributes: You may use these HTML tags and attributes: </p>
*@					</div>
@*					<div class="details-thumb">
						<div class="details-thumb-prev">
							<div class="thumb-icon">
								<i class="icofont icofont-simple-left"></i>
							</div>
							<div class="thumb-text">
								<h4>Previous Post</h4>
								<p>Standard Post With Gallery</p>
							</div>
						</div>
						<div class="details-thumb-next">
							<div class="thumb-text">
								<h4>Next Post</h4>
								<p>Standard Post With Preview Image</p>
							</div>
							<div class="thumb-icon">
								<i class="icofont icofont-simple-right"></i>
							</div>
						</div>
					</div>
*@				</div>
			</div>
			<div class="col-lg-3">
				<div class="blog-sidebar">
					<h4>Recent Comments</h4>
					<ul id="AllComment">
						@foreach(var item in Model.Comments)
						{
							<li>@item.comment <br /><span style="color:#eb315a;font-size:10px;">@item.CommentDate.ToString("MMM dd yyyy - HH:mm tt") </span></li>
						}
						@*<li><a href="#">admin on Mask Man</a></li>
						<li><a href="#">admin on Angle Pori</a></li>
						<li><a href="#">admin on The Man</a></li>
						<li><a href="#">admin on WP Devil</a></li>*@
					</ul>
					<div class="portfolio-sidebar">
						<img src="/img/sidebar/sidebar1.png" alt="sidebar" />
						<img src="/img/sidebar/sidebar2.png" alt="sidebar" />
						<img src="/img/sidebar/sidebar4.png" alt="sidebar" />
					</div>
				</div>
			</div>
		</div>
	</div>
</section>


@*@section Scripts{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.3/signalr.min.js" 
    integrity="sha512-/rQxup+foY5qwZmEmvBhb0PHxx/Fd+ESH7Xw+pozdSKhygl+ZSQm1X6LWDQrxz+NoRAZwR03X78UinlY1C4RrQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
		var Hub = new signalR.HubConnectionBuilder().withUrl("/MovieHub").build();
        Hub.start().then(function(){
            console.log("Connect Success");
        });

		Hub.on("NewCommentAdd", function (commentObj) {
			if (commentObj.movieID == @Model.Id) {
				console.log(commentObj+"fsdsdsfffssfsfsfsfff");
				$("#All").append("<li>" + commentObj.id + ":" + commentObj.comment + "</li>")
            }
        })

        //function SendMessage(){
        //    var name = $("#Name").val();
        //    var Msg = $("#Msg").val();
        //    console.log(name+":"+Msg);
        //    Hub.invoke("NewComment",name,Msg,Model.ID);
        //}
    </script>
}*@

@section Scripts{
	@*<script src="~/lib/microsoft-signalr/signalr.min.js"></script>*@
	<script src="https://cdnjs.cloudflare.com/ajax/libs/aspnet-signalr/1.1.4/signalr.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.3/signalr.min.js"
			integrity="sha512-/rQxup+foY5qwZmEmvBhb0PHxx/Fd+ESH7Xw+pozdSKhygl+ZSQm1X6LWDQrxz+NoRAZwR03X78UinlY1C4RrQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script>
		
		//1-declare hub "URL"
		var hub = new signalR.HubConnectionBuilder().withUrl("/MovieHub").build();
		//2-start connect as online client
		hub.start().then(function () {
			console.log("Connect Success");
		});


		//3-server fire event  notification ==>handel
		//function SendComment() {
		//var com = $("#textcomment").val();
		//var comment = { comt: com, movieid: Model.Movie.Id, userid: Model.UserID, CommentDate: new Date().toISOString() }
		////text,Model.Movie.Id,Model.UserID
		//hub.on("WriteComment", function (comment) {
		//	$("#AllComment").append("<li>" + name + " : " + text + "</li>")

		//});
		//}

		hub.on("NewComment", function (c) {
			console.log("from NewComment method " + c.comment + " " + c.CommentDate + " " + c.userID + " " + c.movieID);
			//$("#AllMsg").append("<li>" + c.comment + " " + c.CommentDate + " " + c.userID + "</li>");
			$("#AllComment").append("<li>" + c.comment +"<br/><span style='color:#eb315a;font-size:10px;'>Now</span></li>");

		});

		console.log("berfor");

		function SendComment() {
			console.log("After");

			let com = $("#textcomment").val();
			console.log(com);

			// Create a new Comment object with the provided data
			var date=new Date();
			let comment = {
				'comt': com,
				'movieid': @Model.Movie.Id,
				'userid': "@Model.UserID.ToString()", //Model.UserID,
				'commentdate': date.toISOString()
			};

			// Invoke the hub.WriteComment method with the Comment object
			//hub.invoke("WriteComment",comment);
			console.log(com)
			console.log("from WriteComment method" + comment);
			
			console.log(date.toISOString().toString());
			hub.invoke("WriteComment", com, "@Model.Movie.Id.ToString()", "@Model.UserID.ToString()", date.toISOString().toString())// @Model.UserID
		}
	</script>

}

